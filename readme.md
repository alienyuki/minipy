# minipy

这是一个简单的python虚拟机的玩具实现，其目标是接受编译好的pyc文件作为输入并运行。
该项目目的是了解python运行的基本原理，是对CPython的拙劣模仿，可能不会实现编译部分，也不会很追求性能。

## 开始
该项目仅在Linux上测试过。由于使用了一些glibc的函数，可能无法在Windows上运行。
需要有python3.12（自行编译或conda安装）。在目录下添加python3.12软链接，或者设置环境变量`PY312`指定路径。
`make`即可开始进行所有测试，或者添加`PYTARGET`环境变量指定测试名称。

## 文件目录
```
.
|- object/     // 实现的类
|- test/       // 测试文件，包括测试的python文件以及针对部分功能测试的.c文件
|- vm/         // 虚拟机相关，包括虚拟机框架，反序列化，调试，垃圾收集等
|- Makefile
|- readme.md
```

## 已实现的特性
1. 基本对象的支持：long, str, list, dict, func, code等。
2. 虚拟机基本框架：取指->译码->执行，栈帧，程序计数器等。
3. 虚拟机字节码：支持部分常见的字节码，具体在`vm/opcode.h`中。
4. 垃圾收集功能：包括引用计数和标记清除算法。
5. 函数的支持：可以声明函数，函数调用并递归。
6. 内建函数的支持：支持`print`，`input`等，并且可以扩展。
7. 内建类的支持：可以产生整数，字符串，列表，字典并调用对应方法。
8. 调试功能。指定环境变量`MINIPY_DBG=1`运行，可以进入调试界面。

## 可能会实现的特性
1. 更多的字节码（`FOR_ITER`，`YIELD`等）。
2. 更复杂的函数调用（闭包，lambda，关键字参数等）。
3. 自定义类。
4. 更丰富的调试指令。
5. 异常。
